// Simulador de Experi√™ncia do Usu√°rio - Teste de Jornada Completa
class UserJourneySimulator {
    constructor() {
        this.currentStep = 0;
        this.steps = [];
        this.init();
    }
    
    init() {
        console.log('üöÄ === INICIANDO SIMULA√á√ÉO DE JORNADA DO USU√ÅRIO ===');
        this.defineSteps();
        this.createSimulationUI();
        this.startSimulation();
    }
    
    defineSteps() {
        this.steps = [
            {
                name: 'Chegada ao Site',
                description: 'Usu√°rio acessa o site pela primeira vez',
                action: () => this.simulatePageLoad(),
                validation: () => document.querySelector('#ofertas-especiais') !== null
            },
            {
                name: 'Visualiza√ß√£o das Ofertas',
                description: 'Usu√°rio navega para se√ß√£o de ofertas',
                action: () => this.simulateOfferNavigation(),
                validation: () => window.getComputedStyle(document.querySelector('#ofertas-especiais')).display !== 'none'
            },
            {
                name: 'An√°lise de Produtos',
                description: 'Usu√°rio analisa produtos em oferta',
                action: () => this.simulateProductAnalysis(),
                validation: () => document.querySelectorAll('.flash-deal-item').length > 0
            },
            {
                name: 'Verifica√ß√£o de Timers',
                description: 'Usu√°rio verifica tempo restante das ofertas',
                action: () => this.simulateTimerCheck(),
                validation: () => document.querySelector('.timer-container') !== null
            },
            {
                name: 'Intera√ß√£o com Produtos',
                description: 'Usu√°rio interage com produtos espec√≠ficos',
                action: () => this.simulateProductInteraction(),
                validation: () => true
            },
            {
                name: 'Decis√£o de Compra',
                description: 'Usu√°rio decide comprar um produto',
                action: () => this.simulatePurchaseDecision(),
                validation: () => document.querySelectorAll('.btn-comprar').length > 0
            },
            {
                name: 'Feedback Final',
                description: 'Experi√™ncia geral do usu√°rio',
                action: () => this.generateUserFeedback(),
                validation: () => true
            }
        ];
    }
    
    createSimulationUI() {
        const panel = document.createElement('div');
        panel.id = 'user-journey-panel';
        panel.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            width: 350px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 20px;
            color: white;
            font-family: Arial, sans-serif;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            z-index: 9999;
            transform: translateX(400px);
            transition: transform 0.5s ease;
        `;
        
        panel.innerHTML = `
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 style="margin: 0; font-size: 1.2em;">üöÄ Jornada do Usu√°rio</h3>
                <button onclick="this.parentElement.parentElement.style.transform='translateX(400px)'" style="
                    background: rgba(255,255,255,0.2);
                    border: none;
                    color: white;
                    border-radius: 50%;
                    width: 30px;
                    height: 30px;
                    cursor: pointer;
                ">√ó</button>
            </div>
            <div id="journey-progress" style="margin-bottom: 15px;"></div>
            <div id="journey-current-step" style="
                background: rgba(255,255,255,0.1);
                padding: 15px;
                border-radius: 10px;
                margin-bottom: 15px;
                min-height: 100px;
            "></div>
            <div style="text-align: center;">
                <button onclick="window.userJourney.nextStep()" style="
                    background: rgba(255,255,255,0.2);
                    border: 1px solid rgba(255,255,255,0.3);
                    color: white;
                    padding: 8px 16px;
                    border-radius: 20px;
                    cursor: pointer;
                    margin: 5px;
                ">‚ñ∂Ô∏è Pr√≥ximo Passo</button>
                <button onclick="window.userJourney.restart()" style="
                    background: rgba(255,255,255,0.2);
                    border: 1px solid rgba(255,255,255,0.3);
                    color: white;
                    padding: 8px 16px;
                    border-radius: 20px;
                    cursor: pointer;
                    margin: 5px;
                ">üîÑ Reiniciar</button>
            </div>
        `;
        
        document.body.appendChild(panel);
        
        setTimeout(() => {
            panel.style.transform = 'translateX(0)';
        }, 1000);
        
        return panel;
    }
    
    async startSimulation() {
        await this.delay(2000);
        console.log('üë§ Iniciando simula√ß√£o de jornada do usu√°rio...');
        this.updateUI();
        await this.executeCurrentStep();
    }
    
    async executeCurrentStep() {
        if (this.currentStep >= this.steps.length) {
            this.completeJourney();
            return;
        }
        
        const step = this.steps[this.currentStep];
        console.log(`üé¨ Executando: ${step.name}`);
        
        try {
            await step.action();
            await this.delay(1000);
            
            const isValid = step.validation();
            console.log(`‚úÖ ${step.name}: ${isValid ? 'Sucesso' : 'Falha'}`);
            
            this.updateStepResult(isValid);
        } catch (error) {
            console.error(`‚ùå Erro em ${step.name}:`, error);
            this.updateStepResult(false);
        }
    }
    
    async simulatePageLoad() {
        console.log('üìÑ Simulando carregamento da p√°gina...');
        
        // Verifica se todos os elementos cr√≠ticos est√£o presentes
        const criticalElements = [
            '#ofertas-especiais',
            '.bottom-nav',
            '.flash-deals-grid'
        ];
        
        for (const selector of criticalElements) {
            const element = document.querySelector(selector);
            if (!element) {
                console.warn(`‚ö†Ô∏è Elemento cr√≠tico n√£o encontrado: ${selector}`);
            }
        }
        
        // Simula tempo de carregamento
        await this.delay(1500);
        console.log('‚úÖ P√°gina carregada com sucesso');
    }
    
    async simulateOfferNavigation() {
        console.log('üß≠ Simulando navega√ß√£o para ofertas...');
        
        const offerBtn = document.querySelectorAll('.nav-item')[2];
        if (offerBtn) {
            offerBtn.click();
            await this.delay(500);
            
            // Verifica se a se√ß√£o est√° vis√≠vel
            const section = document.querySelector('#ofertas-especiais');
            if (section) {
                section.scrollIntoView({ behavior: 'smooth' });
            }
        }
        
        console.log('üéØ Navega√ß√£o para ofertas executada');
    }
    
    async simulateProductAnalysis() {
        console.log('üîç Simulando an√°lise de produtos...');
        
        const products = document.querySelectorAll('.flash-deal-item');
        console.log(`üì¶ Encontrados ${products.length} produtos em oferta`);
        
        // Simula visualiza√ß√£o de cada produto
        for (let i = 0; i < Math.min(products.length, 3); i++) {
            const product = products[i];
            product.scrollIntoView({ behavior: 'smooth', block: 'center' });
            
            // Simula hover no produto
            product.style.transform = 'scale(1.02)';
            await this.delay(800);
            product.style.transform = 'scale(1)';
            
            console.log(`üëÄ Analisando produto ${i + 1}`);
        }
        
        console.log('üîé An√°lise de produtos conclu√≠da');
    }
    
    async simulateTimerCheck() {
        console.log('‚è∞ Simulando verifica√ß√£o de timers...');
        
        const timers = document.querySelectorAll('.deal-timer, .timer-container');
        console.log(`‚è±Ô∏è Encontrados ${timers.length} timers ativos`);
        
        // Destaca os timers
        timers.forEach((timer, index) => {
            setTimeout(() => {
                timer.style.outline = '2px solid #ff6b6b';
                timer.style.outlineOffset = '4px';
                setTimeout(() => {
                    timer.style.outline = 'none';
                }, 1000);
            }, index * 300);
        });
        
        await this.delay(2000);
        console.log('‚è∞ Verifica√ß√£o de timers conclu√≠da');
    }
    
    async simulateProductInteraction() {
        console.log('üñ±Ô∏è Simulando intera√ß√£o com produtos...');
        
        const products = document.querySelectorAll('.flash-deal-item');
        if (products.length > 0) {
            const randomProduct = products[Math.floor(Math.random() * products.length)];
            
            // Simula clique no produto
            randomProduct.scrollIntoView({ behavior: 'smooth', block: 'center' });
            await this.delay(500);
            
            // Adiciona efeito visual
            randomProduct.style.boxShadow = '0 0 20px rgba(255, 107, 107, 0.5)';
            randomProduct.style.transform = 'scale(1.05)';
            
            await this.delay(1500);
            
            randomProduct.style.boxShadow = '';
            randomProduct.style.transform = '';
            
            console.log('üéØ Produto selecionado para an√°lise detalhada');
        }
        
        console.log('‚úÖ Intera√ß√£o com produtos finalizada');
    }
    
    async simulatePurchaseDecision() {
        console.log('üí≥ Simulando processo de decis√£o de compra...');
        
        const buyButtons = document.querySelectorAll('.btn-comprar');
        if (buyButtons.length > 0) {
            const randomButton = buyButtons[Math.floor(Math.random() * buyButtons.length)];
            
            // Destaca o bot√£o de compra
            randomButton.scrollIntoView({ behavior: 'smooth', block: 'center' });
            await this.delay(500);
            
            randomButton.style.animation = 'pulse 1s infinite';
            await this.delay(2000);
            randomButton.style.animation = '';
            
            console.log('üõí Decis√£o de compra simulada');
        }
        
        console.log('üí∞ Processo de compra finalizado');
    }
    
    async generateUserFeedback() {
        console.log('üìù Gerando feedback do usu√°rio...');
        
        const feedback = this.calculateUserExperience();
        console.log('üë§ Feedback do usu√°rio:', feedback);
        
        // Mostra feedback no painel
        this.showFeedback(feedback);
        
        await this.delay(1000);
        console.log('‚úÖ Feedback gerado com sucesso');
    }
    
    calculateUserExperience() {
        let score = 0;
        const criteria = [];
        
        // Verifica navega√ß√£o
        if (document.querySelector('#ofertas-especiais') && 
            window.getComputedStyle(document.querySelector('#ofertas-especiais')).display !== 'none') {
            score += 20;
            criteria.push('‚úÖ Navega√ß√£o funcional');
        } else {
            criteria.push('‚ùå Problemas de navega√ß√£o');
        }
        
        // Verifica ofertas
        const offers = document.querySelectorAll('.flash-deal-item');
        if (offers.length > 0) {
            score += 25;
            criteria.push(`‚úÖ ${offers.length} ofertas dispon√≠veis`);
        } else {
            criteria.push('‚ùå Nenhuma oferta encontrada');
        }
        
        // Verifica timers
        const timers = document.querySelectorAll('.deal-timer, .timer-container');
        if (timers.length > 0) {
            score += 20;
            criteria.push(`‚úÖ ${timers.length} timers ativos`);
        } else {
            criteria.push('‚ùå Timers n√£o funcionando');
        }
        
        // Verifica CTAs
        const ctas = document.querySelectorAll('.btn-comprar');
        if (ctas.length > 0) {
            score += 15;
            criteria.push(`‚úÖ ${ctas.length} bot√µes de compra`);
        } else {
            criteria.push('‚ùå Bot√µes de compra ausentes');
        }
        
        // Verifica responsividade
        if (window.innerWidth > 768 || document.querySelector('.bottom-nav')) {
            score += 10;
            criteria.push('‚úÖ Design responsivo');
        } else {
            criteria.push('‚ùå Problemas de responsividade');
        }
        
        // Verifica performance
        if (document.readyState === 'complete') {
            score += 10;
            criteria.push('‚úÖ Carregamento r√°pido');
        } else {
            criteria.push('‚ö†Ô∏è Carregamento lento');
        }
        
        return {
            score,
            maxScore: 100,
            percentage: Math.round((score / 100) * 100),
            criteria,
            sentiment: this.getSentiment(score)
        };
    }
    
    getSentiment(score) {
        if (score >= 90) return 'üòç Excelente experi√™ncia!';
        if (score >= 80) return 'üòä Muito satisfeito';
        if (score >= 70) return 'üôÇ Experi√™ncia positiva';
        if (score >= 60) return 'üòê Experi√™ncia regular';
        if (score >= 50) return 'üòï Experi√™ncia abaixo do esperado';
        return 'üò§ Experi√™ncia frustrante';
    }
    
    showFeedback(feedback) {
        const currentStepElement = document.querySelector('#journey-current-step');
        if (currentStepElement) {
            currentStepElement.innerHTML = `
                <h4>üìä Feedback Final do Usu√°rio</h4>
                <div style="text-align: center; margin-bottom: 15px;">
                    <div style="font-size: 2em;">${feedback.percentage}%</div>
                    <div>${feedback.sentiment}</div>
                </div>
                <div style="font-size: 0.9em;">
                    ${feedback.criteria.map(c => `<div style="margin: 5px 0;">${c}</div>`).join('')}
                </div>
            `;
        }
    }
    
    async nextStep() {
        this.currentStep++;
        this.updateUI();
        await this.executeCurrentStep();
    }
    
    restart() {
        this.currentStep = 0;
        console.log('üîÑ Reiniciando simula√ß√£o de jornada...');
        this.updateUI();
        this.executeCurrentStep();
    }
    
    updateUI() {
        const progressElement = document.querySelector('#journey-progress');
        const currentStepElement = document.querySelector('#journey-current-step');
        
        if (!progressElement || !currentStepElement) return;
        
        // Atualiza barra de progresso
        const progress = Math.round((this.currentStep / this.steps.length) * 100);
        progressElement.innerHTML = `
            <div style="background: rgba(255,255,255,0.2); border-radius: 10px; padding: 3px;">
                <div style="
                    background: white;
                    height: 8px;
                    border-radius: 8px;
                    width: ${progress}%;
                    transition: width 0.3s ease;
                "></div>
            </div>
            <div style="text-align: center; margin-top: 5px; font-size: 0.9em;">
                Passo ${this.currentStep}/${this.steps.length}
            </div>
        `;
        
        // Atualiza passo atual
        if (this.currentStep < this.steps.length) {
            const step = this.steps[this.currentStep];
            currentStepElement.innerHTML = `
                <h4>${step.name}</h4>
                <p style="margin: 10px 0; opacity: 0.9;">${step.description}</p>
                <div style="font-size: 0.8em; opacity: 0.7;">
                    üé¨ Executando simula√ß√£o...
                </div>
            `;
        }
    }
    
    updateStepResult(success) {
        const currentStepElement = document.querySelector('#journey-current-step');
        if (currentStepElement && this.currentStep < this.steps.length) {
            const step = this.steps[this.currentStep];
            currentStepElement.innerHTML = `
                <h4>${step.name} ${success ? '‚úÖ' : '‚ùå'}</h4>
                <p style="margin: 10px 0; opacity: 0.9;">${step.description}</p>
                <div style="font-size: 0.8em; ${success ? 'color: #4ade80;' : 'color: #ef4444;'}">
                    ${success ? '‚úÖ Conclu√≠do com sucesso' : '‚ùå Falha na execu√ß√£o'}
                </div>
            `;
        }
    }
    
    completeJourney() {
        console.log('üéâ Jornada do usu√°rio conclu√≠da!');
        const currentStepElement = document.querySelector('#journey-current-step');
        if (currentStepElement) {
            currentStepElement.innerHTML = `
                <h4>üéâ Jornada Conclu√≠da!</h4>
                <p>Simula√ß√£o completa da experi√™ncia do usu√°rio.</p>
                <div style="text-align: center; margin-top: 15px;">
                    <button onclick="window.userJourney.restart()" style="
                        background: rgba(255,255,255,0.2);
                        border: 1px solid rgba(255,255,255,0.3);
                        color: white;
                        padding: 10px 20px;
                        border-radius: 20px;
                        cursor: pointer;
                    ">üîÑ Simular Novamente</button>
                </div>
            `;
        }
    }
    
    delay(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
}

// Auto-inicializa√ß√£o
document.addEventListener('DOMContentLoaded', () => {
    setTimeout(() => {
        console.log('üöÄ Iniciando simulador de jornada do usu√°rio...');
        window.userJourney = new UserJourneySimulator();
    }, 7000);
});

console.log('üöÄ Simulador de jornada do usu√°rio carregado!');